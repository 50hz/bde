<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BDE 2.16 BETA: bslalg_autoarraydestructor Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <style>
      div.hanging {
        padding-left: 0.75in;
        text-indent: -0.50in;
      }
      div.unhanging {
        text-indent:     0in;
      }
      a.glossary {
        font-weight: bold;
        font-style: italic;
      }
    </style>
</head>
<!--
<body onload='searchBox.OnSelectItem(0);'>
-->
<body>

<table border=0 cellspacing=0 cellpadding=0 align=center>
<tr>
 <td valign=top align=center>
 <p align=center><b><i>Quick Links:</i></b></p>
 </td>
 <td valign=top align=center>
 <p align=center>
<a class="qindex" href="group__bsl__P__bslhdrs.html">bsl+bslhdrs</a> | <a class="qindex" href="group__bsl__P__stdhdrs.html">bsl+stdhdrs</a> | <a class="qindex" href="group__bslalg.html">bslalg</a> | <a class="qindex" href="group__bsldoc.html">bsldoc</a> | <a class="qindex" href="group__bslim.html">bslim</a> | <a class="qindex" href="group__bslma.html">bslma</a> | <a class="qindex" href="group__bslmf.html">bslmf</a> | <a class="qindex" href="group__bsls.html">bsls</a> | <a class="qindex" href="group__bslscm.html">bslscm</a> | <a class="qindex" href="group__bslstl.html">bslstl</a> | <a class="qindex" href="group__bsltf.html">bsltf</a>
 </td>
 </tr>
 </table>

  </div>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="components.html"><span>Components</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<h1>Component bslalg_autoarraydestructor<br/>
<small>
[<a class="el" href="group__bslalg.html">Package bslalg</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Provide a proctor for destroying arrays.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebslalg.html">bslalg</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="user"><dt><b>Outline</b></dt><dd><ul>
<li>
<a href="#1">Purpose</a> </li>
<li>
<a href="#2">Classes</a> </li>
<li>
<a href="#3">Description</a> <ul>
<li>
<a href="#3.1">Usage</a> </li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="purpose"></a> <a class="anchor" id="1"></a> </dd></dl>
<dl class="user"><dt><b>Purpose: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Provide a proctor for destroying arrays. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="classes"></a> <a class="anchor" id="2"></a> </dd></dl>
<dl class="user"><dt><b>Classes: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><table class="doxtable">
<tr>
<td><a class="el" href="classbslalg_1_1AutoArrayDestructor.html">bslalg::AutoArrayDestructor</a> </td><td>exception-neutrality proctor for arrays  </td></tr>
</table>
</dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__bslma__autodestructor.html" title="Provide a range proctor to manage an array of objects.">Component bslma_autodestructor</a> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="description"></a> <a class="anchor" id="3"></a> </dd></dl>
<dl class="user"><dt><b>Description: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>This component provides a proctor object to manage a contiguous (in-place) sequence of otherwise-unmanaged instances of a user-defined type. If not explicitly released, all objects managed by the proctor object are automatically destroyed by the proctor's destructor, using the <code>bslalg_arraydestructionprimitives</code>. </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd><a class="anchor" id="usage"></a> <a class="anchor" id="description.usage"></a> <a class="anchor" id="3.1"></a> </dd></dl>
<dl class="user"><dt><b>Usage: </b></dt><dd></dd></dl>
<dl class="user"><dt><b></b></dt><dd>The usage example is nearly identical to that of <code>bslma_autodestructor</code>, so we will only quote and adapt a small portion of that usage example. Namely, we will focus on an array that supports arbitrary user-defined types, and suppose that we want to implement insertion of an arbitrary number of elements at some (intermediate) position in the array, taking care that if an element copy constructor or assignment operator throws, the whole array is left in a valid (but unspecified) state. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Consider the implementation of the <code>insert</code> method for a templatized array below. The proctor's <em>origin</em> is set (at construction) to refer to the <code>numItems</code> position past <code>array[length]</code>. Initially, the proctor manages no objects (i.e., its end is the same as its beginning). <br/>
<br/>
<div class="fragment"><pre class="fragment">     0     1     2     3     4     5     6     7
   _____ _____ _____ _____ _____ _____ _____ _____
  | <span class="stringliteral">&quot;A&quot;</span> | <span class="stringliteral">&quot;B&quot;</span> | <span class="stringliteral">&quot;C&quot;</span> | <span class="stringliteral">&quot;D&quot;</span> | <span class="stringliteral">&quot;E&quot;</span> |xxxxx|xxxxx|xxxxx|
  `=====^=====^=====^=====^=====^=====^=====^=====<span class="stringliteral">&#39;</span>
<span class="stringliteral">  my_Array                                  ^----- AutoArrayDestructor</span>
<span class="stringliteral">  (length = 5)</span>
<span class="stringliteral"></span>
<span class="stringliteral">              Figure: Use of proctor for my_Array::insert</span>
</pre></div><br/>
<br/>
 As each of the elements at index positions beyond the insertion position is shifted up by two index positions, the proctor's begin address is <em>decremented</em>. At the same time, the array's length is <em>decremented</em> to ensure that each array element is always being managed (during an allocation attempt) either by the proctor or the array itself, but not both. <br/>
<br/>
<div class="fragment"><pre class="fragment">     0     1     2     3     4     5     6     7
   _____ _____ _____ _____ _____ _____ _____ _____
  | <span class="stringliteral">&quot;A&quot;</span> | <span class="stringliteral">&quot;B&quot;</span> | <span class="stringliteral">&quot;C&quot;</span> | <span class="stringliteral">&quot;D&quot;</span> |xxxxx|xxxxx| <span class="stringliteral">&quot;E&quot;</span> |xxxxx|
  `=====^=====^=====^=====^=====^=====^=====^=====<span class="stringliteral">&#39;</span>
<span class="stringliteral">  my_Array                            ^     ^ AutoArrayDestructor::end</span>
<span class="stringliteral">  (length = 4)                        `---- AutoArrayDestructor::begin</span>
<span class="stringliteral"></span>
<span class="stringliteral">              Figure: Configuration after shifting up one element</span>
</pre></div><br/>
<br/>
 After the required number of elements have been shifted, the hole is filled (backwards) by copies of the element to be inserted. The code for the templatized <code>insert</code> method is as follows: <br/>
<br/>
<div class="fragment"><pre class="fragment">  <span class="comment">// Assume no aliasing.</span>
  <span class="keyword">template</span> &lt;<span class="keyword">class</span> TYPE&gt; <span class="keyword">inline</span>
  <span class="keywordtype">void</span> my_Array&lt;TYPE&gt;::insert(<span class="keywordtype">int</span> dstIndex, <span class="keyword">const</span> TYPE&amp; item, <span class="keywordtype">int</span> numItems)
  {
      <span class="keywordflow">if</span> (d_length &gt;= d_size) {
          this-&gt;increaseSize(numItems);
      }

      <span class="keywordtype">int</span>   origLen = d_length;
      TYPE *src     = &amp;d_array_p[d_length];
      TYPE *src     = &amp;d_array_p[d_length + numItems];
      <a class="code" href="classbslalg_1_1AutoArrayDestructor.html">bslalg::AutoArrayDestructor&lt;TYPE&gt;</a> autoDtor(dest, dest);

      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = d_length; i &gt; dstIndex; --i, --d_length) {
          dest = autoDtor.moveBegin(-1);  <span class="comment">// decrement destination</span>
          <span class="keyword">new</span>(dest) TYPE(--src);          <span class="comment">// copy to new index</span>
          src-&gt;~TYPE();                   <span class="comment">// destroy original</span>
      }
      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = numItems; i &gt; 0; --i) {
          dest = autoDtor.moveBegin(-1);  <span class="comment">// decrement destination</span>
          <span class="keyword">new</span>(dest) TYPE(item);           <span class="comment">// copy new value into hole</span>
      }
      autoDtor.release();
      d_length = origLen + numItems;
  }
</pre></div><br/>
<br/>
 Note that in the <code>insert</code> example above, we illustrate exception neutrality, but not alias safety (i.e., in the case when <code>item</code> is a reference into the portion of the array at <code>dstIndex</code> or beyond). </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Nov 12 2012 13:19:41 for BDE Release 2.16 Open Source "BETA" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
